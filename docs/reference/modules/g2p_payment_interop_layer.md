# G2P Payment Interop Layer

The G2P Payment Interop Layer module provides a crucial bridge between OpenSPP's social protection programs and external digital financial service providers (DFSPs) or payment gateways. It enables OpenSPP to securely and efficiently send payment instructions for beneficiary disbursements to these external systems, ensuring timely and accurate delivery of benefits.

## Purpose

This module streamlines the disbursement of social protection payments by automating the communication with external payment systems. It empowers program administrators to manage payments with greater efficiency and transparency:

*   **Automate Payment Disbursements**: It facilitates the automatic sending of payment requests to designated external payment endpoints, eliminating manual intervention in the transfer process.
*   **Support Diverse Payee Identification**: The module allows administrators to specify various methods for identifying beneficiaries for payment, such as bank account numbers, IBANs, phone numbers, email addresses, or specific registrant IDs.
*   **Streamline Batch Processing**: Administrators can configure the module to automatically create and process payment batches, ensuring that groups of payments are handled together for efficiency.
*   **Track Payment Status in Real-time**: It processes responses from external payment systems to update the status of individual payments and entire batches within OpenSPP, providing immediate feedback on disbursement success or failure.
*   **Integrate with External Financial Systems**: The module establishes a standardized interface for connecting OpenSPP's payment management with a wide range of external digital financial service providers.

## Dependencies and Integration

The G2P Payment Interop Layer module is a specialized extension of OpenSPP's core payment management capabilities, deeply integrated with other foundational modules.

It extends the core `g2p.program.payment.manager` functionality, adding specific configurations required for interoperable payments. This allows OpenSPP to offer the Payment Interoperability Layer as a distinct method for processing program disbursements.

This module relies heavily on:
*   **[G2P Registry Base](g2p_registry_base)**: It retrieves critical beneficiary data from the registry, such as bank account details, phone numbers, email addresses, or specific identification numbers, which are essential for directing payments to the correct recipients.
*   **[G2P Programs](g2p_programs)**: It receives payment batches and individual payment records generated by program cycles. This module then uses this information to construct payment requests for external systems, linking disbursements directly to defined program entitlements.

## Additional Functionality

The G2P Payment Interop Layer module offers specific features to configure and manage external payment interactions:

### External Payment Endpoint Configuration
Administrators configure a dedicated **Payment Endpoint URL** within the module. This URL is the specific address of the external payment gateway or DFSP where OpenSPP will send payment requests for processing. This ensures that all payment instructions are directed to the correct external system.

### Flexible Payee Identification Mapping
The module provides a **Payee ID Field** option, allowing administrators to select how beneficiaries will be identified by the external payment system. Options include Bank Account Number, IBAN, Phone, Email, or a specific Registrant ID. If a Registrant ID is chosen, administrators can further specify the **Payee DFSP ID Type** to ensure the correct ID is used (e.g., National ID, Passport Number). This flexibility ensures compatibility with various external payment systems' requirements.

### Automated Batch Creation and Processing
An **Automatically Create Batch** option streamlines the payment process. When enabled, the module automatically groups individual payments into batches for efficient processing and transmission to the external payment endpoint. This reduces manual effort and ensures all eligible payments are prepared for disbursement.

### Custom Batch Tagging
Administrators can assign **Batch Tags** to payment batches processed through this module. These tags allow for custom categorization and filtering of payment disbursements, which can be useful for internal tracking, reporting, or specific program requirements.

### Real-time Payment Status Updates
After sending payment requests, the module actively processes responses from the external payment system. It then updates the status of individual payments within OpenSPP to reflect whether they were "sent," "reconciled," "paid," or "failed," providing a clear audit trail and real-time visibility into the disbursement process.

## Conclusion

The G2P Payment Interop Layer module is essential for OpenSPP, enabling secure and automated digital payment disbursements by effectively integrating with external financial service providers. It ensures that social protection benefits reach beneficiaries efficiently and transparently.