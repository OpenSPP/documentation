# G2P Payment Simple Mpesa

The 'G2P Payment Simple Mpesa' module integrates OpenSPP with the Mpesa mobile money platform, enabling direct and efficient disbursement of social protection payments to beneficiaries. It acts as a dedicated payment manager, streamlining the process of sending funds for various G2P programs.

## Purpose

This module serves as a specialized payment gateway to facilitate secure and reliable cash transfers through Mpesa. It ensures that social protection benefits reach beneficiaries directly and promptly.

*   **Direct Mpesa Disbursements**: Enables program managers to send payments directly to beneficiary Mpesa accounts, minimizing manual intervention and accelerating fund delivery.
*   **Flexible Payee Identification**: Supports various methods to identify beneficiaries for payment, including phone numbers, bank account numbers, IBANs, emails, or specific registrant IDs.
*   **Automated Batch Processing**: Manages the grouping and processing of multiple payments in batches, improving efficiency for large-scale disbursement events.
*   **Secure API Integration**: Handles secure authentication and communication with the Mpesa payment gateway, protecting sensitive payment information.
*   **Payment Status Tracking**: Updates the status of individual payments and entire batches within OpenSPP, providing visibility into the disbursement process.

## Dependencies and Integration

The 'G2P Payment Simple Mpesa' module builds upon core OpenSPP functionalities to manage payments effectively.

*   **Base**: This module relies on the fundamental Odoo 'base' module, providing essential system functionalities such as user management, access rights, and core data structures.
*   **G2P Registry Base ([g2p_registry_base](g2p_registry_base))**: It integrates with the base registrant registry to retrieve critical beneficiary information. This includes registrant phone numbers, bank details, or specific identification values, which are essential for directing payments to the correct Mpesa accounts.
*   **G2P Programs ([g2p_programs](g2p_programs))**: This module serves the 'G2P Programs' module by providing a mechanism to execute payments generated by program cycles and entitlements. It receives payment instructions from programs and processes them through the configured Mpesa gateway.

## Additional Functionality

The module offers key features designed to make Mpesa payment management robust and user-friendly.

### Configurable Mpesa API Settings
Users can configure the necessary Mpesa API endpoints and credentials directly within the module. This includes setting the Authentication Endpoint URL, Payment Endpoint URL, username, and password required to securely connect to the Mpesa service. An API Timeout setting ensures system responsiveness during transactions.

### Flexible Payee Identification
The module allows program administrators to specify how beneficiaries are identified for Mpesa payments. Options include using a registrant's registered phone number, bank account number, IBAN, email address, or a specific registrant ID type. For registrant IDs, users can select a particular ID type (e.g., National ID) to ensure the correct identifier is used for payment.

### Automated Batch Payment Creation and Management
The module supports the automatic creation of payment batches based on predefined criteria. Users can associate specific "Batch Tags" to group payments, providing flexibility in organizing disbursements. An option to "Automatically Create Batch" streamlines the process for recurring payments, ensuring efficient processing of multiple transactions.

### Payment Execution and Status Updates
Once configured, the module initiates the payment process by securely authenticating with Mpesa and then sending individual payments within a batch. It tracks the status of each payment, updating it to 'sent' and 'paid' upon successful transfer. The system also logs any errors during authentication or payment transfer, providing clear notifications to program managers.

## Conclusion

The 'G2P Payment Simple Mpesa' module is a vital component of OpenSPP, enabling efficient, secure, and flexible disbursement of social protection benefits directly through the Mpesa mobile money platform.