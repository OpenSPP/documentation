<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Configuring Keycloak for OAuth &mdash; OpenSPP Documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="canonical" href="https://docs.openspp.org/config_and_admin/oidc.html" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/debug.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Audit Logs" href="audit_logs.html" />
    <link rel="prev" title="Managing Users" href="../using/managing_users.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> OpenSPP
          </a>
              <div class="version">
                2.0-dev
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional_architecture.html">Functional Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">Licensing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Registrants</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../registrants/concepts.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../registrants/exporting.html">Exporting Registrants</a></li>
<li class="toctree-l1"><a class="reference internal" href="../registrants/importing.html">Importing Registrants</a></li>
<li class="toctree-l1"><a class="reference internal" href="../registrants/api.html">API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Programs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../programs/concepts.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../programs/dashboards.html">Dashboards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../programs/program_manager.html">Program Manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../programs/cycle_manager.html">Cycle Manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../programs/eligibility_manager.html">Eligibility Manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../programs/entitlement_manager.html">Entitlement Manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../programs/deduplication_manager.html">Deduplication Manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../programs/notification_manager.html">Notification Manager</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Disbursement Service</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../disbursement/index.html">Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../using/managing_programs.html">Managing Programs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using/managing_users.html">Managing Users</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">System Configuration and Administration</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Configuring Keycloak for OAuth</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#configuration">Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#configure-keycloak">Configure Keycloak</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configure-odoo">Configure Odoo</a></li>
<li class="toctree-l3"><a class="reference internal" href="#customizing-the-login-page-optional">Customizing the login page (Optional)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#using">Using</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#existing-users">Existing users</a></li>
<li class="toctree-l3"><a class="reference internal" href="#new-users">New users</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="audit_logs.html">Audit Logs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Community</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contribution/module_lifecycle_development_status.html">Modules Maturity Levels and Development Status Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribution/module_lifecycle_maintainer_role.html">Module Lifecycle - Maintainer Role Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../code_of_conduct.html">Contributor Covenant Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security-report.html">OpenSPP Vulnerability Disclosure Policy</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">OpenSPP</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">Configuring Keycloak for OAuth</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/openspp/documentation/blob/main/docs/config_and_admin/oidc.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="configuring-keycloak-for-oauth">
<h1>Configuring Keycloak for OAuth<a class="headerlink" href="#configuring-keycloak-for-oauth" title="Permalink to this headline"></a></h1>
<p>We recommend using Keycloak as the authentication provider for OpenSPP. This allows for a single sign-on
experience for users and ensures that the authentication mechanism can evolve independently of the systems
using it, thus ensuring that the authentication mechanism can be secured and act as a shield in front of the
systems.</p>
<p>Although other OIDC-compliant providers can be used, we have only tested Keycloak.</p>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline"></a></h2>
<p>If you are using OpenSPP’s <a class="reference external" href="https://github.com/openspp/openspp-docker">docker-compose setup</a>, you already have
the <code class="docutils literal notranslate"><span class="pre">auth_oidc</span></code> from <a class="reference external" href="https://github.com/OCA/server-auth">OCA</a> installed, otherwise you will need to install
it.</p>
<section id="configure-keycloak">
<h3>Configure Keycloak<a class="headerlink" href="#configure-keycloak" title="Permalink to this headline"></a></h3>
<ol class="arabic simple">
<li><p>Go to the admin console of your keycloak instance</p></li>
<li><p>Create a new realm (if needed), in our example we use <code class="docutils literal notranslate"><span class="pre">odoo</span></code>.</p></li>
<li><p>Create a new client, in our example we use <code class="docutils literal notranslate"><span class="pre">odoo</span></code>.</p></li>
<li><p>Enable <code class="docutils literal notranslate"><span class="pre">standard</span> <span class="pre">flow</span></code> and save.</p></li>
<li><p>Set the <code class="docutils literal notranslate"><span class="pre">Valid</span> <span class="pre">redirect</span> <span class="pre">URIs</span></code> to be “&lt;url of your server&gt;/auth_oauth/signin”.</p></li>
<li><p>Enable <code class="docutils literal notranslate"><span class="pre">Client</span> <span class="pre">authentication</span></code>.</p></li>
<li><p>Go to the “Credentials” tab and copy the <code class="docutils literal notranslate"><span class="pre">Client</span> <span class="pre">secret</span></code> to be used later.</p></li>
</ol>
</section>
<section id="configure-odoo">
<h3>Configure Odoo<a class="headerlink" href="#configure-odoo" title="Permalink to this headline"></a></h3>
<ol class="arabic simple">
<li><p>Install <code class="docutils literal notranslate"><span class="pre">Authentication</span> <span class="pre">OpenID</span> <span class="pre">Connect</span></code> from the Apps menu.</p></li>
<li><p>Go to <code class="docutils literal notranslate"><span class="pre">Settings</span> <span class="pre">&gt;</span> <span class="pre">General</span> <span class="pre">Settings</span> <span class="pre">&gt;</span> <span class="pre">Integrations</span> <span class="pre">&gt;</span> <span class="pre">oAuth</span> <span class="pre">Authentication</span> <span class="pre">&gt;</span> <span class="pre">oAuth</span> <span class="pre">Providers</span></code> and configure
it as following:</p>
<ul class="simple">
<li><p><strong>Provider name</strong>: Keycloak (or any name you like that identify your keycloak provider)</p></li>
<li><p><strong>Auth Flow</strong>: OpenID Connect (authorization code flow)</p></li>
<li><p><strong>Client ID</strong>: the same Client ID you entered when configuring the client in Keycloak</p></li>
<li><p><strong>Client Secret</strong>: found in keycloak on the client Credentials tab</p></li>
<li><p><strong>Allowed</strong>: yes</p></li>
<li><p><strong>Body</strong>: the link text to appear on the login page, such as Login with Keycloak</p></li>
<li><p><strong>Scope</strong>: openid email</p></li>
<li><p><strong>Authentication URL</strong>: The “authorization_endpoint” URL found in the OpenID Endpoint Configuration of
your Keycloak realm</p></li>
<li><p><strong>Token URL</strong>: The “token_endpoint” URL found in the OpenID Endpoint Configuration of your Keycloak realm</p></li>
<li><p><strong>JWKS URL</strong>: The “jwks_uri” URL found in the OpenID Endpoint Configuration of your Keycloak realm</p></li>
</ul>
</li>
</ol>
<p><strong>For example:</strong></p>
<p><img alt="" src="../_images/openspp_oidc_configuration.png" /></p>
</section>
<section id="customizing-the-login-page-optional">
<h3>Customizing the login page (Optional)<a class="headerlink" href="#customizing-the-login-page-optional" title="Permalink to this headline"></a></h3>
<p>To align with corporate branding, you can customize the login page by adding a custom logo and a custom
background image.</p>
<ul class="simple">
<li><p><strong>Enable Developer Settings</strong>: “Settings” &gt; “Activate The Developer Mode”</p></li>
<li><p><strong>Edit The Login Template</strong>: “Settings” &gt; “Technical” &gt; “User Interface &gt; Views” &gt; Search for “Login”</p></li>
</ul>
</section>
</section>
<section id="using">
<h2>Using<a class="headerlink" href="#using" title="Permalink to this headline"></a></h2>
<section id="existing-users">
<h3>Existing users<a class="headerlink" href="#existing-users" title="Permalink to this headline"></a></h3>
<p>For users that already existed before the OIDC-integration was configured, there is a need for them to go
through the reset password process. This is because the password is not stored in Odoo, but in Keycloak.
Depending on the configuration, the user may have to perform 2FA setup.</p>
</section>
<section id="new-users">
<h3>New users<a class="headerlink" href="#new-users" title="Permalink to this headline"></a></h3>
<p>For new users, create their user account in OpenSPP/Odoo with the same email address used in <code class="docutils literal notranslate"><span class="pre">Keycloak</span></code> and
they will be able to login. Note that in order to be able to get past the self-service user management page,
permissions need to be set for the user.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../using/managing_users.html" class="btn btn-neutral float-left" title="Managing Users" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="audit_logs.html" class="btn btn-neutral float-right" title="Audit Logs" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022 OpenSPP.org Licensed under CC BY 4.0.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> OpenSPP</span>
    v: latest
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <!--    <dl>-->
    <!--      <dt>Versions</dt>-->
    <!---->
    <!--      <dd><a href="#">latest</a></dd>-->
    <!--      <dd><a href="#">1.0</a></dd>-->
    <!--      <dd><a href="#">1.1</a></dd>-->
    <!---->
    <!--    </dl>-->
    <!--    <dl>-->
    <!--      <dt>Downloads</dt>-->
    <!--      <dd><a href="#">PDF</a></dd>-->
    <!--      <dd><a href="#">ePub</a></dd>-->
    <!--      <dd><a href="#">HTML</a></dd>-->
    <!--    </dl>-->
    <dl>
      <dt>OpenSPP</dt>
      <dd>
        <a href="https://github.com/openspp/documentation/">Project Home</a>
      </dd>
      <!-- <dd>
        <a href="https://github.com/openspp/documentation/releases">Releases</a>
      </dd> -->
    </dl>
    <!--    <dl>-->
    <!--      <dt>Debug</dt>-->
    <!--      <dd><a href="#" data-toggle="rst-debug-badge">Swap badge position</a></dd>-->
    <!--    </dl>-->
  </div>
</div>

</body>
</html>