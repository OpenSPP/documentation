
<!DOCTYPE html>

<html>
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<!-- Google tag (gtag.js) -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-RS4T4ZPG52"></script>
<script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-RS4T4ZPG52');
    </script>
<meta content="Key Management" property="og:title"/>
<meta content="website" property="og:type"/>
<meta content="https://docs.openspp.org/ops_guide/security/key_management.html" property="og:url"/>
<meta content="OpenSPP Documentation" property="og:site_name"/>
<meta content="This guide is for sys admins managing encryption keys for OpenSPP. Encryption keys protect your data. Lose the keys, lose the data. This guide covers key generation, storage, rotation, and recovery..." property="og:description"/>
<meta content="https://docs.openspp.org/_static/openspp_logo.png" property="og:image"/>
<meta content="OpenSPP Documentation" property="og:image:alt"/>
<meta content="This guide is for sys admins managing encryption keys for OpenSPP. Encryption keys protect your data. Lose the keys, lose the data. This guide covers key generation, storage, rotation, and recovery..." name="description"/>
<meta content="en_US" property="og:locale"/>
<title>Key Management – Operations guide – Security — OpenSPP Documentation v2.0</title>
<!-- Loaded before other Sphinx assets -->
<link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet"/>
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet"/>
<link href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css" rel="stylesheet"/>
<link as="font" crossorigin="" href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="" href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2" rel="preload" type="font/woff2"/>
<link href="../../_static/pygments.css" rel="stylesheet" type="text/css">
<link href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" rel="stylesheet" type="text/css">
<link href="../../_static/copybutton.css" rel="stylesheet" type="text/css">
<link href="../../_static/sphinxcontrib-httpexample.css" rel="stylesheet" type="text/css">
<link href="../../_static/graphviz.css" rel="stylesheet" type="text/css">
<link href="../../_static/custom.css" rel="stylesheet" type="text/css"/>
<link href="../../_static/print.css" media="print" rel="stylesheet" type="text/css"/>
<link href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" rel="stylesheet" type="text/css"/>
<!-- Pre-loaded scripts that we'll load fully later -->
<link as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf" rel="preload"/>
<script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
<script src="../../_static/jquery.js"></script>
<script src="../../_static/underscore.js"></script>
<script src="../../_static/doctools.js"></script>
<script src="../../_static/clipboard.min.js"></script>
<script src="../../_static/copybutton.js"></script>
<script src="../../_static/sphinxcontrib-httpexample.js"></script>
<script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
<script crossorigin="anonymous" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mermaid@11.4.0/dist/mermaid.min.js"></script>
<script src="../../_static/search-utils.js"></script>
<script src="../../_static/mermaid_init.js"></script>
<script src="../../_static/patch_scrollToActive.js"></script>
<script src="../../_static/search_shortcut.js"></script>
<script src="../../_static/module-filter.js"></script>
<script src="../../_static/design-tabs.js"></script>
<link href="https://docs.openspp.org/ops_guide/security/key_management.html" rel="canonical">
<link href="../../_static/opensearch.xml" rel="search" title="Search within OpenSPP Documentation v2.0" type="application/opensearchdescription+xml"/>
<link href="../../_static/icon_192.png" rel="shortcut icon"/>
<link href="../../genindex.html" rel="index" title="Index"/>
<link href="../../search.html" rel="search" title="Search"/>
<link href="audit.html" rel="next" title="Audit Logging"/>
<link href="pii_encryption.html" rel="prev" title="PII Encryption"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="None" name="docsearch:language"/>
<!-- Google Analytics -->
<!-- Review Status System - DISABLED
<link rel="stylesheet" href="../../_static/review_status.css" type="text/css" />
<script src="../../_static/review_status_simple.js"></script>
-->
<script crossorigin="anonymous" integrity="sha384-vJ1NXwwlC62VkTLRHyzdAfyL4rQ8Z478DeHgamh37YzGJh3T6j223FC2yMRVriLl" src="https://cdn.jsdelivr.net/npm/less@4.1.1"></script>
<!-- Mermaid Support -->
<script crossorigin="anonymous" integrity="sha384-+NGfjU8KzpDLXRHduEqW+ZiJr2rIg+cidUVk7B51R5xK7cHwMKQfrdFwGdrq1Bcz" src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    mermaid.initialize({
        startOnLoad: true,
        theme: 'default',
        themeVariables: {
            primaryColor: '#0066cc',
            primaryTextColor: '#000000',
            primaryBorderColor: '#0066cc'
        }
    });
});
</script>
<!-- Matomo Tag Manager -->
<!-- End Matomo Tag Manager -->
</link></link></link></link></link></link></head>
<body data-offset="100" data-spy="scroll" data-target="#bd-toc-nav">
<!-- Checkboxes to toggle the left sidebar -->
<input aria-label="Toggle navigation sidebar" class="sidebar-toggle" id="__navigation" name="__navigation" type="checkbox"/>
<label class="overlay overlay-navbar" for="__navigation">
<div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input aria-label="Toggle in-page Table of Contents" class="sidebar-toggle" id="__page-toc" name="__page-toc" type="checkbox"/>
<label class="overlay overlay-pagetoc" for="__page-toc">
<div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>
<div class="container-fluid" id="banner"></div>
<div class="container-xl">
<div class="row">
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
<div class="bd-sidebar__content">
<div class="bd-sidebar__top"><div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../">
<h1 class="site-logo" id="site-title">OpenSPP Documentation v2.0</h1>
</a>
</div><form action="../../search.html" class="bd-search d-flex align-items-center" method="get">
<div class="input-group">
<label class="sr-only" for="q">Search string
    </label>
<i aria-hidden="true" class="fa fa-search fa-lg search-icon"></i>
<input aria-labelledby="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="form-control" id="search-input" name="q" placeholder="Search" spellcheck="false" type="search" value="">
<div class="input-group-append">
<span class="input-group-text" id="shortcut">
<kbd id="search-shortcut">⌘</kbd> <kbd>K</kbd>
</span>
</div>
</input></div>
</form><nav aria-label="Main" class="bd-links" id="bd-docs-nav">
<div class="bd-toc-item active">
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../products/">
   Products
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox">
<label for="toctree-checkbox-1">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../products/sp_mis.html">
     OpenSPP SP-MIS
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../products/social_registry.html">
     OpenSPP Social Registry
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../products/farmer_registry.html">
     OpenSPP Farmer Registry
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../products/drims.html">
     OpenSPP DRIMS
    </a>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../products/features/">
     Features
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
<label for="toctree-checkbox-2">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../products/features/unified_registry.html">
       Unified registry
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../products/features/gis_land_management.html">
       GIS &amp; land management
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../products/features/program_management.html">
       Program management
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../products/features/eligibility_targeting.html">
       Eligibility &amp; targeting
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../products/features/payment_disbursement.html">
       Payment &amp; disbursement
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../products/features/in_kind_benefits.html">
       In-Kind benefits
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../products/features/data_integration_apis.html">
       Data integration &amp; APIs
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../products/features/change_management.html">
       Change management
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../products/features/grievance_redress.html">
       Grievance redress
      </a>
</li>
</ul>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../products/whats_new_v2.html">
     What's new in OpenSPP v2
    </a>
</li>
</ul>
</input></li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../learn/">
   Learn
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
<label for="toctree-checkbox-3">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../learn/concepts/registry.html">
     Registry
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../learn/concepts/programs.html">
     Programs
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../learn/concepts/cycles.html">
     Cycles
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../learn/concepts/eligibility.html">
     Eligibility
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../learn/concepts/compliance.html">
     Compliance
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../learn/concepts/entitlements.html">
     Entitlements
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../learn/concepts/payments.html">
     Payments
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../learn/concepts/deduplication.html">
     Deduplication
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../learn/concepts/change-requests.html">
     Change requests
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../get_started/">
   Get started
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
<label for="toctree-checkbox-4">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../get_started/installation/">
     Installing OpenSPP
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
<label for="toctree-checkbox-5">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../get_started/installation/docker.html">
       Docker installation
      </a>
</li>
</ul>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../get_started/modules/">
     Module installation
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
<label for="toctree-checkbox-6">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../get_started/modules/spmis_installation.html">
       SP-MIS installation
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../get_started/modules/social_installation.html">
       Social Registry installation
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../get_started/modules/farmer_installation.html">
       Farmer Registry installation
      </a>
</li>
</ul>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../get_started/explore/">
     Explore OpenSPP
    </a>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../get_started/first_household/">
     Your first household
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
<label for="toctree-checkbox-7">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../get_started/first_household/01_access_registry.html">
       Step 1: Access the Registry
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../get_started/first_household/02_create_household.html">
       Step 2: Create a Household
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../get_started/first_household/03_add_members.html">
       Step 3: Add members
      </a>
</li>
</ul>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../get_started/first_program/">
     Your first program
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
<label for="toctree-checkbox-8">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../get_started/first_program/01_access_program.html">
       Step 1: Access the program section
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../get_started/first_program/02_create_program.html">
       Step 2: Create your first social protection program
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../get_started/first_program/03_enroll_beneficiaries.html">
       Step 3: Import and enroll beneficiaries
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../get_started/first_program/04_run_cycle.html">
       Step 4: Understanding program cycles
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../get_started/first_program/05_distribute_entitlements.html">
       Step 5: Distribute entitlements
      </a>
</li>
</ul>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../get_started/poc_and_pilot.html">
     From Proof of Concept to Pilot
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../user_guide/">
   User guide
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
<label for="toctree-checkbox-9">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../user_guide/getting_started/">
     Getting started
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
<label for="toctree-checkbox-10">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../user_guide/getting_started/navigation.html">
       Navigating the OpenSPP interface
      </a>
</li>
</ul>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../user_guide/registry/">
     Registry
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
<label for="toctree-checkbox-11">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../user_guide/registry/register_individual.html">
       Register an individual
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../user_guide/registry/register_group.html">
       Register a group
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../user_guide/registry/search_filter.html">
       Search and filter registrants
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../user_guide/registry/import_data.html">
       Import registrant data
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../user_guide/registry/export_data.html">
       Export registrant data
      </a>
</li>
</ul>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../user_guide/change_requests/">
     Change Requests
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
<label for="toctree-checkbox-12">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../user_guide/change_requests/submit_change_request.html">
       Submit a change request
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../user_guide/change_requests/review_change_request.html">
       Review a change request
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../user_guide/change_requests/change_request_types.html">
       Change request types
      </a>
</li>
</ul>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../user_guide/programs/">
     Programs
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
<label for="toctree-checkbox-13">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../user_guide/programs/create_programs.html">
       Create programs
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../user_guide/programs/program_cycles.html">
       Work with program cycles
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../user_guide/programs/enroll_beneficiaries.html">
       Enroll beneficiaries
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../user_guide/programs/allocate_funds.html">
       Allocate funds to programs
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../user_guide/programs/manage_entitlements.html">
       Manage entitlements
      </a>
</li>
</ul>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../user_guide/payments/">
     Payments
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
<label for="toctree-checkbox-14">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../user_guide/payments/service_points.html">
       View Service Points
      </a>
</li>
</ul>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../user_guide/approvals/">
     Approvals
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
<label for="toctree-checkbox-15">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../user_guide/approvals/manage_approvals.html">
       Review and Approve Requests
      </a>
</li>
</ul>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../user_guide/reference/">
     Reference
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
<label for="toctree-checkbox-16">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../user_guide/reference/areas_geography.html">
       Geographic Areas
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../user_guide/reference/vocabularies.html">
       Vocabularies (Code Lists)
      </a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../config_guide/">
   Configuration guide
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
<label for="toctree-checkbox-17">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../config_guide/studio/">
     OpenSPP Studio
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/>
<label for="toctree-checkbox-18">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/studio/overview.html">
       Studio Overview
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/studio/registry_field_builder.html">
       Custom Fields (Registry Field Builder)
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/studio/event_type_designer.html">
       Event Type Designer
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/studio/change_request_builder.html">
       Change Request Builder
      </a>
</li>
</ul>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../config_guide/cel/">
     CEL expressions
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/>
<label for="toctree-checkbox-19">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/cel/quick_start.html">
       CEL quick start
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/cel/syntax.html">
       CEL syntax reference
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/cel/variables.html">
       Variables
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/cel/cookbook.html">
       CEL cookbook
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/cel/troubleshooting.html">
       CEL troubleshooting
      </a>
</li>
</ul>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../config_guide/eligibility/">
     Eligibility rules
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/>
<label for="toctree-checkbox-20">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/eligibility/cel_expressions.html">
       CEL expressions for eligibility
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/eligibility/geographic_targeting.html">
       Geographic targeting
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/eligibility/templates.html">
       Expression templates
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/eligibility/testing.html">
       Testing eligibility rules
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/eligibility/advanced.html">
       Advanced eligibility configuration
      </a>
</li>
</ul>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../config_guide/entitlement_formulas/">
     Entitlement formulas
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/>
<label for="toctree-checkbox-21">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/entitlement_formulas/cash_calculations.html">
       Cash calculations
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/entitlement_formulas/inkind_baskets.html">
       In-kind and basket entitlements
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/entitlement_formulas/formula_library.html">
       Formula library
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/entitlement_formulas/dynamic_entitlements.html">
       Dynamic entitlements
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/entitlement_formulas/conditional_logic.html">
       Conditional logic
      </a>
</li>
</ul>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../config_guide/vocabulary/">
     Vocabulary System
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" type="checkbox"/>
<label for="toctree-checkbox-22">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/vocabulary/overview.html">
       Vocabulary Overview
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/vocabulary/standard_vocabularies.html">
       Standard Vocabularies
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/vocabulary/profiles.html">
       Vocabulary Profiles
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/vocabulary/custom.html">
       Custom Vocabularies
      </a>
</li>
</ul>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../config_guide/variables/">
     Variables &amp; Indicators
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" type="checkbox"/>
<label for="toctree-checkbox-23">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/variables/overview.html">
       Variables Overview
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/variables/creating_variables.html">
       Creating Variables
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/variables/variable_types.html">
       Variable Types
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/variables/using_variables.html">
       Using Variables in CEL
      </a>
</li>
</ul>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../config_guide/event_data/">
     Event Data
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" type="checkbox"/>
<label for="toctree-checkbox-24">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/event_data/overview.html">
       Event Data Overview
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/event_data/event_types.html">
       Configuring Event Types
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/event_data/field_definitions.html">
       Defining Event Fields
      </a>
</li>
</ul>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../config_guide/change_request_types/">
     Change request types
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" type="checkbox"/>
<label for="toctree-checkbox-25">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/change_request_types/overview.html">
       Overview
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/change_request_types/creating_types.html">
       Creating change request types
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/change_request_types/field_mappings.html">
       Field mappings
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/change_request_types/conflict_detection.html">
       Conflict and duplicate detection
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/change_request_types/patterns.html">
       Common configuration patterns
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/change_request_types/custom_detail_models.html">
       Custom detail models
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/change_request_types/troubleshooting.html">
       Troubleshooting
      </a>
</li>
</ul>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../config_guide/consent/">
     Consent configuration
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" type="checkbox"/>
<label for="toctree-checkbox-26">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/consent/overview.html">
       Consent management overview
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/consent/privacy_notices.html">
       Configuring privacy notices
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/consent/recording_consent.html">
       Recording consent
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/consent/api_consent_filtering.html">
       API consent filtering
      </a>
</li>
</ul>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../config_guide/role_configuration/">
     Role configuration
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" type="checkbox"/>
<label for="toctree-checkbox-27">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/role_configuration/overview.html">
       Access control overview
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/role_configuration/assigning_roles.html">
       Assigning roles to users
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/role_configuration/predefined_roles.html">
       Predefined roles
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/role_configuration/creating_roles.html">
       Creating custom roles
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../config_guide/role_configuration/troubleshooting.html">
       Troubleshooting
      </a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current active has-children">
<a class="reference internal" href="../">
   Operations guide
  </a>
<input checked="" class="toctree-checkbox" id="toctree-checkbox-28" name="toctree-checkbox-28" type="checkbox"/>
<label for="toctree-checkbox-28">
<i class="fas fa-chevron-down">
</i>
</label>
<ul class="current">
<li class="toctree-l2 has-children">
<a class="reference internal" href="../deployment/">
     Deployment
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-29" name="toctree-checkbox-29" type="checkbox"/>
<label for="toctree-checkbox-29">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../deployment/production-hardening.html">
       Production Hardening
      </a>
</li>
</ul>
</li>
<li class="toctree-l2 current active has-children">
<a class="reference internal" href="">
     Security
    </a>
<input checked="" class="toctree-checkbox" id="toctree-checkbox-30" name="toctree-checkbox-30" type="checkbox"/>
<label for="toctree-checkbox-30">
<i class="fas fa-chevron-down">
</i>
</label>
<ul class="current">
<li class="toctree-l3">
<a class="reference internal" href="access_control.html">
       Access Control
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="data_classification.html">
       Data Classification
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="pii_encryption.html">
       PII Encryption
      </a>
</li>
<li class="toctree-l3 current active">
<a class="current reference internal" href="#">
       Key Management
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="audit.html">
       Audit Logging
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="scanning.html">
       Security Scanning
      </a>
</li>
</ul>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../storage/">
     Storage
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../backup/">
     Backup &amp; Recovery
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../monitoring/">
     Monitoring &amp; Alerts
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../reference/">
   Reference
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-31" name="toctree-checkbox-31" type="checkbox"/>
<label for="toctree-checkbox-31">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../reference/modules/">
     Modules Reference
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-32" name="toctree-checkbox-32" type="checkbox"/>
<label for="toctree-checkbox-32">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_api_v2.html">
       API V2
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_api_v2_cycles.html">
       API V2 - Cycles
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_api_v2_data.html">
       API V2 - Data
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_api_v2_entitlements.html">
       API V2 - Entitlements
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_api_v2_products.html">
       API V2 - Products
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_api_v2_service_points.html">
       API V2 - Service Points
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_api_v2_vocabulary.html">
       API V2 - Vocabulary
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_approval.html">
       Approval Workflows
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_area.html">
       Area Management
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_audit.html">
       Audit
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_banking.html">
       Banking / Bank Details
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_base_common.html">
       Base (Common)
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_base_setting.html">
       Base Settings
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_branding_kit.html">
       Branding Kit
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_cel_domain.html">
       CEL Domain Query Builder
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_cel_widget.html">
       CEL Expression Widget
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_change_request_v2.html">
       Change Request V2
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_claim_169.html">
       QR Credentials (Claim 169)
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_consent.html">
       Consent
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_cr_types_advanced.html">
       CR Types - Advanced
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_cr_types_base.html">
       CR Types - Base
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_custom_field.html">
       Custom Fields
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_dci_client.html">
       DCI Client
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_dci_client_crvs.html">
       DCI Client - CRVS
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_dci_client_dr.html">
       DCI Client - Disability Registry
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_dci_client_ibr.html">
       DCI Client - IBR
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_dci_server.html">
       DCI Server
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_demo.html">
       Demo
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_dms.html">
       Document Management System
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_event_data.html">
       Event Data
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_gis.html">
       GIS
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_gis_report.html">
       GIS Reports
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_grm.html">
       Grievance Redress Mechanism
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_hide_menus_base.html">
       Hide Menus Base
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_key_management.html">
       Key Management
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_mis_demo_v2.html">
       MIS Demo V2
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_programs.html">
       Programs
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_registry.html">
       Registry
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_registry_search.html">
       Registry Search Portal
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_security.html">
       Security
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_service_points.html">
       Service Points
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_source_tracking.html">
       Source Tracking
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_starter_social_registry.html">
       Starter: Social Registry
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_starter_sp_mis.html">
       Starter: SP-MIS
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_studio.html">
       Studio
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_studio_change_requests.html">
       Studio - Change Requests
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_studio_events.html">
       Studio - Events
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_user_roles.html">
       User Roles
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_versioning.html">
       Versioning
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/spp_vocabulary.html">
       Vocabulary
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../reference/modules/theme_openspp_muk.html">
       Theme
      </a>
</li>
</ul>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../reference/vocabularies/">
     Vocabulary Reference
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../reference/glossary/humanitarian.html">
     Humanitarian Terms Glossary
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../glossary.html">
     OpenSPP Glossary
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../community_and_support/">
   Community and support
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-33" name="toctree-checkbox-33" type="checkbox"/>
<label for="toctree-checkbox-33">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../community_and_support/how_to_contribute_to_the_project.html">
     Contributing
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../community_and_support/i18n_l10n.html">
     Internationalization and Localization
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../community_and_support/module_lifecycle_development_status.html">
     Modules Maturity Levels and Development Status Policy
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../community_and_support/module_lifecycle_maintainer_role.html">
     Module Lifecycle - Maintainer Role Policy
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../community_and_support/code_of_conduct.html">
     Contributor Covenant Code of Conduct
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../community_and_support/security_report.html">
     OpenSPP Vulnerability Disclosure Policy
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../community_and_support/license.html">
     Licensing
    </a>
</li>
</ul>
</li>
</ul>
</div>
</nav></div>
<div class="bd-sidebar__bottom">
<!-- To handle the deprecated key -->
<div class="navbar_extra_footer">
<p class="openspporglink">
<a href="https://openspp.org">
<img alt="openspp.org" src="/_static/openspp_logo.png"/> openspp.org</a>
</p>
</div>
</div>
</div>
<div id="rtd-footer-container"></div>
</div>
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
<div class="header-article row sticky-top noprint">
<div class="col py-1 d-flex header-article-main">
<div class="header-article__left">
<label class="headerbtn" data-placement="right" data-toggle="tooltip" for="__navigation" title="Toggle navigation">
<span class="headerbtn__icon-container">
<i class="fas fa-bars"></i>
</span>
</label>
</div>
<div class="header-article__label">
<span>Key Management – Operations guide</span>
</div>
<div class="header-article__right">
<button class="headerbtn" data-placement="bottom" data-toggle="tooltip" onclick="toggleFullScreen()" title="Fullscreen mode">
<span class="headerbtn__icon-container">
<i class="fas fa-expand"></i>
</span>
</button>
<div class="menu-dropdown menu-dropdown-repository-buttons">
<button aria-label="Source repositories" class="headerbtn menu-dropdown__trigger">
<i class="fab fa-github"></i>
</button>
<div class="menu-dropdown__content">
<ul>
<li>
<a class="headerbtn" data-placement="left" data-toggle="tooltip" href="https://github.com/openspp/documentation" title="Source repository">
<span class="headerbtn__icon-container">
<i class="fab fa-github"></i>
</span>
<span class="headerbtn__text-container">repository</span>
</a>
</li>
<li>
<a class="headerbtn" data-placement="left" data-toggle="tooltip" href="https://github.com/openspp/documentation/issues/new?title=Issue%20on%20page%20%2Fops_guide/security/key_management.html&amp;body=Your%20issue%20content%20here." title="Open an issue">
<span class="headerbtn__icon-container">
<i class="fas fa-lightbulb"></i>
</span>
<span class="headerbtn__text-container">open issue</span>
</a>
</li>
<li>
<a class="headerbtn" data-placement="left" data-toggle="tooltip" href="https://docs.openspp.org/contributing/?ops_guide/security/key_management.md#making-contributions-on-github" title="Edit this page">
<span class="headerbtn__icon-container">
<i class="fas fa-pencil-alt"></i>
</span>
<span class="headerbtn__text-container">suggest edit</span>
</a>
</li>
</ul>
</div>
</div>
<div class="menu-dropdown menu-dropdown-download-buttons">
<button aria-label="Download this page" class="headerbtn menu-dropdown__trigger">
<i class="fas fa-download"></i>
</button>
<div class="menu-dropdown__content">
<ul>
<li>
<a class="headerbtn" data-placement="left" data-toggle="tooltip" href="../../_sources/ops_guide/security/key_management.md.txt" title="Download source file">
<span class="headerbtn__icon-container">
<i class="fas fa-file"></i>
</span>
<span class="headerbtn__text-container">.md</span>
</a>
</li>
<li>
<button class="headerbtn" data-placement="left" data-toggle="tooltip" onclick="printPdf(this)" title="Print to PDF">
<span class="headerbtn__icon-container">
<i class="fas fa-file-pdf"></i>
</span>
<span class="headerbtn__text-container">.pdf</span>
</button>
</li>
</ul>
</div>
</div>
<label class="headerbtn headerbtn-page-toc" for="__page-toc">
<span class="headerbtn__icon-container">
<i class="fas fa-list"></i>
</span>
</label>
</div>
</div>
<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
<div class="tocsection onthispage pt-5 pb-3">
<i class="fas fa-list"></i> Contents
    </div>
<nav aria-label="Page" id="bd-toc-nav">
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#key-types">
   Key Types
  </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#key-providers">
   Key Providers
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#selecting-a-provider">
     Selecting a Provider
    </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#config-provider-development">
   Config Provider (Development)
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#configuration">
     Configuration
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#generating-keys">
     Generating Keys
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#backing-up-config-keys">
     Backing Up Config Keys
    </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#database-provider-standard-production">
   Database Provider (Standard Production)
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id1">
     Configuration
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#initial-setup">
     Initial Setup
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#checking-keys">
     Checking Keys
    </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#vault-provider-enterprise">
   Vault Provider (Enterprise)
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#vault-setup">
     Vault Setup
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#openspp-configuration">
     OpenSPP Configuration
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#kubernetes-integration">
     Kubernetes Integration
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#testing-vault-connection">
     Testing Vault Connection
    </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#aws-kms-provider">
   AWS KMS Provider
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#aws-setup">
     AWS Setup
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id2">
     OpenSPP Configuration
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#testing-aws-kms">
     Testing AWS KMS
    </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#gcp-kms-provider">
   GCP KMS Provider
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#gcp-setup">
     GCP Setup
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id3">
     OpenSPP Configuration
    </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#azure-key-vault-provider">
   Azure Key Vault Provider
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#azure-setup">
     Azure Setup
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id4">
     OpenSPP Configuration
    </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#key-rotation">
   Key Rotation
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#rotation-process">
     Rotation Process
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#database-provider-rotation">
     Database Provider Rotation
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#vault-provider-rotation">
     Vault Provider Rotation
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#aws-kms-rotation">
     AWS KMS Rotation
    </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#key-backup-and-recovery">
   Key Backup and Recovery
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#config-provider-backup">
     Config Provider Backup
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#database-provider-backup">
     Database Provider Backup
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#vault-provider-backup">
     Vault Provider Backup
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#cloud-kms-backup">
     Cloud KMS Backup
    </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#key-recovery">
   Key Recovery
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#lost-master-key-config-database-provider">
     Lost Master Key (Config/Database Provider)
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#lost-cloud-kms-access">
     Lost Cloud KMS Access
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#testing-key-recovery">
     Testing Key Recovery
    </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#key-escrow">
   Key Escrow
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#manual-escrow">
     Manual Escrow
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#vault-auto-unseal">
     Vault Auto-Unseal
    </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#security-checklist">
   Security Checklist
  </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#troubleshooting">
   Troubleshooting
  </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#related-documentation">
   Related Documentation
  </a>
</li>
</ul>
</nav>
</div>
</div>
<div class="article row">
<div class="col pl-md-3 pl-lg-5 content-container">
<!-- Table of contents that is only displayed when printing the page -->
<div class="onlyprint" id="jb-print-docs-body">
<h1>Key Management</h1>
<!-- Table of contents -->
<div id="print-main-content">
<div id="jb-print-toc">
<div>
<h2> Contents </h2>
</div>
<nav aria-label="Page">
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#key-types">
   Key Types
  </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#key-providers">
   Key Providers
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#selecting-a-provider">
     Selecting a Provider
    </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#config-provider-development">
   Config Provider (Development)
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#configuration">
     Configuration
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#generating-keys">
     Generating Keys
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#backing-up-config-keys">
     Backing Up Config Keys
    </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#database-provider-standard-production">
   Database Provider (Standard Production)
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id1">
     Configuration
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#initial-setup">
     Initial Setup
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#checking-keys">
     Checking Keys
    </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#vault-provider-enterprise">
   Vault Provider (Enterprise)
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#vault-setup">
     Vault Setup
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#openspp-configuration">
     OpenSPP Configuration
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#kubernetes-integration">
     Kubernetes Integration
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#testing-vault-connection">
     Testing Vault Connection
    </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#aws-kms-provider">
   AWS KMS Provider
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#aws-setup">
     AWS Setup
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id2">
     OpenSPP Configuration
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#testing-aws-kms">
     Testing AWS KMS
    </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#gcp-kms-provider">
   GCP KMS Provider
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#gcp-setup">
     GCP Setup
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id3">
     OpenSPP Configuration
    </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#azure-key-vault-provider">
   Azure Key Vault Provider
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#azure-setup">
     Azure Setup
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id4">
     OpenSPP Configuration
    </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#key-rotation">
   Key Rotation
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#rotation-process">
     Rotation Process
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#database-provider-rotation">
     Database Provider Rotation
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#vault-provider-rotation">
     Vault Provider Rotation
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#aws-kms-rotation">
     AWS KMS Rotation
    </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#key-backup-and-recovery">
   Key Backup and Recovery
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#config-provider-backup">
     Config Provider Backup
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#database-provider-backup">
     Database Provider Backup
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#vault-provider-backup">
     Vault Provider Backup
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#cloud-kms-backup">
     Cloud KMS Backup
    </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#key-recovery">
   Key Recovery
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#lost-master-key-config-database-provider">
     Lost Master Key (Config/Database Provider)
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#lost-cloud-kms-access">
     Lost Cloud KMS Access
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#testing-key-recovery">
     Testing Key Recovery
    </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#key-escrow">
   Key Escrow
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#manual-escrow">
     Manual Escrow
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#vault-auto-unseal">
     Vault Auto-Unseal
    </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#security-checklist">
   Security Checklist
  </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#troubleshooting">
   Troubleshooting
  </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#related-documentation">
   Related Documentation
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<main id="main-content" role="main">
<div>
<div class="section" id="key-management">
<h1>Key Management<a class="headerlink" href="#key-management" title="Permalink to this headline">#</a></h1>
<p>This guide is for <strong>sys admins</strong> managing encryption keys for OpenSPP.</p>
<p>Encryption keys protect your data. Lose the keys, lose the data. This guide covers key generation, storage, rotation, and recovery.</p>
<div class="section" id="key-types">
<h2>Key Types<a class="headerlink" href="#key-types" title="Permalink to this headline">#</a></h2>
<p>OpenSPP uses multiple keys:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Key</p></th>
<th class="head"><p>Purpose</p></th>
<th class="head"><p>Rotation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Master Key</p></td>
<td><p>Encrypts other keys (envelope encryption)</p></td>
<td><p>Annually</p></td>
</tr>
<tr class="row-odd"><td><p>PII Key</p></td>
<td><p>Encrypts personal data fields</p></td>
<td><p>Annually</p></td>
</tr>
<tr class="row-even"><td><p>Index Salt</p></td>
<td><p>HMAC for blind indexes</p></td>
<td><p>Never (breaks search)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="key-providers">
<h2>Key Providers<a class="headerlink" href="#key-providers" title="Permalink to this headline">#</a></h2>
<p>OpenSPP supports 6 key providers:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Provider</p></th>
<th class="head"><p>Use Case</p></th>
<th class="head"><p>Security</p></th>
<th class="head"><p>Complexity</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Config</p></td>
<td><p>Development/testing</p></td>
<td><p>Low</p></td>
<td><p>Minimal</p></td>
</tr>
<tr class="row-odd"><td><p>Database</p></td>
<td><p>Small production</p></td>
<td><p>Medium</p></td>
<td><p>Low</p></td>
</tr>
<tr class="row-even"><td><p>Vault</p></td>
<td><p>Enterprise</p></td>
<td><p>High</p></td>
<td><p>Medium</p></td>
</tr>
<tr class="row-odd"><td><p>AWS KMS</p></td>
<td><p>AWS deployments</p></td>
<td><p>High</p></td>
<td><p>Medium</p></td>
</tr>
<tr class="row-even"><td><p>GCP KMS</p></td>
<td><p>GCP deployments</p></td>
<td><p>High</p></td>
<td><p>Medium</p></td>
</tr>
<tr class="row-odd"><td><p>Azure KV</p></td>
<td><p>Azure deployments</p></td>
<td><p>High</p></td>
<td><p>Medium</p></td>
</tr>
</tbody>
</table>
<div class="section" id="selecting-a-provider">
<h3>Selecting a Provider<a class="headerlink" href="#selecting-a-provider" title="Permalink to this headline">#</a></h3>
<p>Set in <code class="docutils literal notranslate"><span class="pre">odoo.conf</span></code>:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[encryption]</span>
<span class="na">key_provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">config</span><span class="w">  </span><span class="c1"># or: database, vault, aws_kms, gcp_kms, azure_kv</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="config-provider-development">
<h2>Config Provider (Development)<a class="headerlink" href="#config-provider-development" title="Permalink to this headline">#</a></h2>
<p><strong>Use for:</strong> Development, testing, proof-of-concept</p>
<p><strong>Do not use for:</strong> Production with real data</p>
<div class="section" id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">#</a></h3>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="c1"># /etc/odoo/odoo.conf</span>
<span class="k">[encryption]</span>
<span class="na">key_provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">config</span>

<span class="c1"># Generate keys with: python3 -c "import secrets; print(secrets.token_urlsafe(32))"</span>
<span class="na">encryption_key_master</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&lt;base64_encoded_32_byte_key&gt;</span>
<span class="na">encryption_key_pii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&lt;base64_encoded_32_byte_key&gt;</span>
<span class="na">index_salt_default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&lt;base64_encoded_32_byte_salt&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="generating-keys">
<h3>Generating Keys<a class="headerlink" href="#generating-keys" title="Permalink to this headline">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate master key</span>
python3<span class="w"> </span>-c<span class="w"> </span><span class="s2">"import secrets; print('encryption_key_master =', secrets.token_urlsafe(32))"</span>

<span class="c1"># Generate PII key</span>
python3<span class="w"> </span>-c<span class="w"> </span><span class="s2">"import secrets; print('encryption_key_pii =', secrets.token_urlsafe(32))"</span>

<span class="c1"># Generate index salt</span>
python3<span class="w"> </span>-c<span class="w"> </span><span class="s2">"import secrets; print('index_salt_default =', secrets.token_urlsafe(32))"</span>

<span class="c1"># Add to odoo.conf</span>
sudo<span class="w"> </span>nano<span class="w"> </span>/etc/odoo/odoo.conf
</pre></div>
</div>
</div>
<div class="section" id="backing-up-config-keys">
<h3>Backing Up Config Keys<a class="headerlink" href="#backing-up-config-keys" title="Permalink to this headline">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract keys from config</span>
grep<span class="w"> </span><span class="s2">"encryption_key\|index_salt"</span><span class="w"> </span>/etc/odoo/odoo.conf<span class="w"> </span>&gt;<span class="w"> </span>/secure/backup/keys_<span class="k">$(</span>date<span class="w"> </span>+%Y%m%d<span class="k">)</span>.conf

<span class="c1"># Encrypt backup</span>
gpg<span class="w"> </span>--symmetric<span class="w"> </span>--cipher-algo<span class="w"> </span>AES256<span class="w"> </span>/secure/backup/keys_*.conf

<span class="c1"># Store encrypted backup securely (off-site)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="database-provider-standard-production">
<h2>Database Provider (Standard Production)<a class="headerlink" href="#database-provider-standard-production" title="Permalink to this headline">#</a></h2>
<p><strong>Use for:</strong> Small to medium production deployments</p>
<p><strong>How it works:</strong> Keys stored in database, encrypted with master key from config</p>
<div class="section" id="id1">
<h3>Configuration<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h3>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="c1"># /etc/odoo/odoo.conf</span>
<span class="k">[encryption]</span>
<span class="na">key_provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">database</span>
<span class="na">encryption_key_master</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&lt;base64_key_from_config&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="initial-setup">
<h3>Initial Setup<a class="headerlink" href="#initial-setup" title="Permalink to this headline">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>odoo-bin<span class="w"> </span>shell<span class="w"> </span>-d<span class="w"> </span>openspp_prod

<span class="c1"># Create PII data key</span>
<span class="nv">master</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>env<span class="o">[</span><span class="s1">'spp.key.provider.database'</span><span class="o">]</span>._get_master_key<span class="o">()</span>
<span class="nv">pii_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>env<span class="o">[</span><span class="s1">'spp.encryption.key'</span><span class="o">]</span>.generate_key<span class="o">(</span>
<span class="w">    </span><span class="nv">key_id</span><span class="o">=</span><span class="s1">'pii'</span>,
<span class="w">    </span><span class="nv">purpose</span><span class="o">=</span><span class="s1">'Encrypt PII fields'</span>,
<span class="w">    </span><span class="nv">algorithm</span><span class="o">=</span><span class="s1">'AES-256-GCM'</span>,
<span class="o">)</span>

<span class="c1"># Create index salt</span>
<span class="nv">index_salt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>env<span class="o">[</span><span class="s1">'spp.encryption.key'</span><span class="o">]</span>.generate_key<span class="o">(</span>
<span class="w">    </span><span class="nv">key_id</span><span class="o">=</span><span class="s1">'index_salt_default'</span>,
<span class="w">    </span><span class="nv">purpose</span><span class="o">=</span><span class="s1">'Blind index salt'</span>,
<span class="w">    </span><span class="nv">algorithm</span><span class="o">=</span><span class="s1">'HMAC-SHA256'</span>,
<span class="o">)</span>

<span class="c1"># Verify keys created</span>
<span class="nv">keys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>env<span class="o">[</span><span class="s1">'spp.encryption.key'</span><span class="o">]</span>.search<span class="o">([])</span>
<span class="k">for</span><span class="w"> </span>key<span class="w"> </span><span class="k">in</span><span class="w"> </span>keys:
<span class="w">    </span>print<span class="o">(</span>f<span class="s2">"{key.key_id} v{key.version}: {key.purpose}"</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="section" id="checking-keys">
<h3>Checking Keys<a class="headerlink" href="#checking-keys" title="Permalink to this headline">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>odoo-bin<span class="w"> </span>shell<span class="w"> </span>-d<span class="w"> </span>openspp_prod

<span class="c1"># List all keys</span>
<span class="nv">keys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>env<span class="o">[</span><span class="s1">'spp.encryption.key'</span><span class="o">]</span>.search<span class="o">([])</span>
<span class="k">for</span><span class="w"> </span>key<span class="w"> </span><span class="k">in</span><span class="w"> </span>keys:
<span class="w">    </span><span class="nv">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"CURRENT"</span><span class="w"> </span><span class="k">if</span><span class="w"> </span>key.is_current<span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s2">"archived"</span>
<span class="w">    </span>print<span class="o">(</span>f<span class="s2">"{key.key_id} v{key.version} [{status}]: {key.purpose}"</span><span class="o">)</span>
<span class="w">    </span>print<span class="o">(</span>f<span class="s2">"  Created: {key.created_date}"</span><span class="o">)</span>
<span class="w">    </span>print<span class="o">(</span>f<span class="s2">"  Expires: {key.expires_date or 'never'}"</span><span class="o">)</span>
</pre></div>
</div>
<p>Via database:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">    </span><span class="n">key_id</span><span class="p">,</span>
<span class="w">    </span><span class="k">version</span><span class="p">,</span>
<span class="w">    </span><span class="n">is_current</span><span class="p">,</span>
<span class="w">    </span><span class="n">algorithm</span><span class="p">,</span>
<span class="w">    </span><span class="n">purpose</span><span class="p">,</span>
<span class="w">    </span><span class="n">created_date</span><span class="p">,</span>
<span class="w">    </span><span class="n">expires_date</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">spp_encryption_key</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">key_id</span><span class="p">,</span><span class="w"> </span><span class="k">version</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="vault-provider-enterprise">
<h2>Vault Provider (Enterprise)<a class="headerlink" href="#vault-provider-enterprise" title="Permalink to this headline">#</a></h2>
<p><strong>Use for:</strong> Enterprise deployments requiring HSM, audit trails, centralized key management</p>
<p><strong>Requires:</strong> HashiCorp Vault with Transit secrets engine</p>
<div class="section" id="vault-setup">
<h3>Vault Setup<a class="headerlink" href="#vault-setup" title="Permalink to this headline">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Enable Transit secrets engine</span>
vault<span class="w"> </span>secrets<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>transit

<span class="c1"># Create encryption key</span>
vault<span class="w"> </span>write<span class="w"> </span>-f<span class="w"> </span>transit/keys/openspp-pii<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="nv">type</span><span class="o">=</span>aes256-gcm96

<span class="c1"># Create policy</span>
vault<span class="w"> </span>policy<span class="w"> </span>write<span class="w"> </span>openspp-encryption<span class="w"> </span>-<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
<span class="s">path "transit/encrypt/openspp-pii" {</span>
<span class="s">  capabilities = ["update"]</span>
<span class="s">}</span>
<span class="s">path "transit/decrypt/openspp-pii" {</span>
<span class="s">  capabilities = ["update"]</span>
<span class="s">}</span>
<span class="s">path "transit/datakey/plaintext/openspp-pii" {</span>
<span class="s">  capabilities = ["update"]</span>
<span class="s">}</span>
<span class="s">EOF</span>

<span class="c1"># Create AppRole for OpenSPP</span>
vault<span class="w"> </span>auth<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>approle
vault<span class="w"> </span>write<span class="w"> </span>auth/approle/role/openspp<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="nv">secret_id_ttl</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="nv">token_ttl</span><span class="o">=</span>1h<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="nv">token_max_ttl</span><span class="o">=</span>4h<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="nv">policies</span><span class="o">=</span><span class="s2">"openspp-encryption"</span>

<span class="c1"># Get credentials</span>
vault<span class="w"> </span><span class="nb">read</span><span class="w"> </span>auth/approle/role/openspp/role-id
vault<span class="w"> </span>write<span class="w"> </span>-f<span class="w"> </span>auth/approle/role/openspp/secret-id
</pre></div>
</div>
</div>
<div class="section" id="openspp-configuration">
<h3>OpenSPP Configuration<a class="headerlink" href="#openspp-configuration" title="Permalink to this headline">#</a></h3>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="c1"># /etc/odoo/odoo.conf</span>
<span class="k">[encryption]</span>
<span class="na">key_provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">vault</span>
<span class="na">vault_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">https://vault.example.com:8200</span>
<span class="na">vault_auth_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">approle</span>
<span class="na">vault_role_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&lt;role_id_from_vault&gt;</span>
<span class="na">vault_secret_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&lt;secret_id_from_vault&gt;</span>
<span class="na">vault_transit_mount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">transit</span>
</pre></div>
</div>
</div>
<div class="section" id="kubernetes-integration">
<h3>Kubernetes Integration<a class="headerlink" href="#kubernetes-integration" title="Permalink to this headline">#</a></h3>
<p>For Kubernetes deployments:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[encryption]</span>
<span class="na">key_provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">vault</span>
<span class="na">vault_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">http://vault.vault.svc.cluster.local:8200</span>
<span class="na">vault_auth_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">kubernetes</span>
<span class="na">vault_k8s_role</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">openspp-prod</span>
<span class="na">vault_transit_mount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">transit</span>
</pre></div>
</div>
<p>Kubernetes service account token is auto-discovered.</p>
</div>
<div class="section" id="testing-vault-connection">
<h3>Testing Vault Connection<a class="headerlink" href="#testing-vault-connection" title="Permalink to this headline">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>odoo-bin<span class="w"> </span>shell<span class="w"> </span>-d<span class="w"> </span>openspp_prod

<span class="nv">provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>env<span class="o">[</span><span class="s1">'spp.key.provider.vault'</span><span class="o">]</span>
try:
<span class="w">    </span><span class="nv">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>provider.get_data_key<span class="o">(</span><span class="s1">'openspp-pii'</span><span class="o">)</span>
<span class="w">    </span>print<span class="o">(</span>f<span class="s2">"Vault connection OK, got key: {len(key)} bytes"</span><span class="o">)</span>
except<span class="w"> </span>Exception<span class="w"> </span>as<span class="w"> </span>e:
<span class="w">    </span>print<span class="o">(</span>f<span class="s2">"Vault connection failed: {e}"</span><span class="o">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="aws-kms-provider">
<h2>AWS KMS Provider<a class="headerlink" href="#aws-kms-provider" title="Permalink to this headline">#</a></h2>
<p><strong>Use for:</strong> AWS deployments (EC2, RDS, EKS)</p>
<p><strong>Requires:</strong> AWS KMS key, IAM permissions</p>
<div class="section" id="aws-setup">
<h3>AWS Setup<a class="headerlink" href="#aws-setup" title="Permalink to this headline">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create KMS key</span>
aws<span class="w"> </span>kms<span class="w"> </span>create-key<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--description<span class="w"> </span><span class="s2">"OpenSPP PII encryption"</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--key-usage<span class="w"> </span>ENCRYPT_DECRYPT<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--origin<span class="w"> </span>AWS_KMS

<span class="c1"># Get key ARN</span>
aws<span class="w"> </span>kms<span class="w"> </span>describe-key<span class="w"> </span>--key-id<span class="w"> </span>&lt;key-id&gt;<span class="w"> </span>--query<span class="w"> </span><span class="s1">'KeyMetadata.Arn'</span>

<span class="c1"># Create alias</span>
aws<span class="w"> </span>kms<span class="w"> </span>create-alias<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--alias-name<span class="w"> </span>alias/openspp-pii<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--target-key-id<span class="w"> </span>&lt;key-id&gt;

<span class="c1"># Grant permissions to EC2 instance role</span>
aws<span class="w"> </span>kms<span class="w"> </span>create-grant<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--key-id<span class="w"> </span>&lt;key-id&gt;<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--grantee-principal<span class="w"> </span>arn:aws:iam::account:role/openspp-instance-role<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--operations<span class="w"> </span>Encrypt<span class="w"> </span>Decrypt<span class="w"> </span>GenerateDataKey
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h3>OpenSPP Configuration<a class="headerlink" href="#id2" title="Permalink to this headline">#</a></h3>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="c1"># /etc/odoo/odoo.conf</span>
<span class="k">[encryption]</span>
<span class="na">key_provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">aws_kms</span>
<span class="na">aws_region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">us-east-1</span>
<span class="na">aws_kms_key_pii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">arn:aws:kms:us-east-1:account:key/key-id</span>

<span class="c1"># If not using instance role, provide credentials:</span>
<span class="na">aws_access_key_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&lt;access_key&gt;</span>
<span class="na">aws_secret_access_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&lt;secret_key&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="testing-aws-kms">
<h3>Testing AWS KMS<a class="headerlink" href="#testing-aws-kms" title="Permalink to this headline">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>odoo-bin<span class="w"> </span>shell<span class="w"> </span>-d<span class="w"> </span>openspp_prod

<span class="nv">provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>env<span class="o">[</span><span class="s1">'spp.key.provider.aws_kms'</span><span class="o">]</span>
try:
<span class="w">    </span><span class="nv">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>provider.get_data_key<span class="o">(</span><span class="s1">'pii'</span><span class="o">)</span>
<span class="w">    </span>print<span class="o">(</span>f<span class="s2">"AWS KMS OK, got {len(key)} byte key"</span><span class="o">)</span>
except<span class="w"> </span>Exception<span class="w"> </span>as<span class="w"> </span>e:
<span class="w">    </span>print<span class="o">(</span>f<span class="s2">"AWS KMS failed: {e}"</span><span class="o">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="gcp-kms-provider">
<h2>GCP KMS Provider<a class="headerlink" href="#gcp-kms-provider" title="Permalink to this headline">#</a></h2>
<p><strong>Use for:</strong> GCP deployments (GCE, CloudSQL, GKE)</p>
<div class="section" id="gcp-setup">
<h3>GCP Setup<a class="headerlink" href="#gcp-setup" title="Permalink to this headline">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create key ring</span>
gcloud<span class="w"> </span>kms<span class="w"> </span>keyrings<span class="w"> </span>create<span class="w"> </span>openspp<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--location<span class="w"> </span>global

<span class="c1"># Create key</span>
gcloud<span class="w"> </span>kms<span class="w"> </span>keys<span class="w"> </span>create<span class="w"> </span>pii-encryption<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--keyring<span class="w"> </span>openspp<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--location<span class="w"> </span>global<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--purpose<span class="w"> </span>encryption

<span class="c1"># Grant permissions</span>
gcloud<span class="w"> </span>kms<span class="w"> </span>keys<span class="w"> </span>add-iam-policy-binding<span class="w"> </span>pii-encryption<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--keyring<span class="w"> </span>openspp<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--location<span class="w"> </span>global<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--member<span class="w"> </span>serviceAccount:openspp@project.iam.gserviceaccount.com<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--role<span class="w"> </span>roles/cloudkms.cryptoKeyEncrypterDecrypter
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h3>OpenSPP Configuration<a class="headerlink" href="#id3" title="Permalink to this headline">#</a></h3>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[encryption]</span>
<span class="na">key_provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">gcp_kms</span>
<span class="na">gcp_project_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">your-project-id</span>
<span class="na">gcp_kms_location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">global</span>
<span class="na">gcp_kms_keyring</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">openspp</span>
<span class="na">gcp_kms_key_pii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">pii-encryption</span>

<span class="c1"># If not using service account:</span>
<span class="na">gcp_credentials_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">/etc/odoo/gcp-credentials.json</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="azure-key-vault-provider">
<h2>Azure Key Vault Provider<a class="headerlink" href="#azure-key-vault-provider" title="Permalink to this headline">#</a></h2>
<p><strong>Use for:</strong> Azure deployments (VMs, Azure Database)</p>
<div class="section" id="azure-setup">
<h3>Azure Setup<a class="headerlink" href="#azure-setup" title="Permalink to this headline">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create Key Vault</span>
az<span class="w"> </span>keyvault<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span>openspp-vault<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--resource-group<span class="w"> </span>openspp-rg<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--location<span class="w"> </span>eastus

<span class="c1"># Create key</span>
az<span class="w"> </span>keyvault<span class="w"> </span>key<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--vault-name<span class="w"> </span>openspp-vault<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span>pii-encryption<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--protection<span class="w"> </span>software<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--ops<span class="w"> </span>encrypt<span class="w"> </span>decrypt

<span class="c1"># Grant access to managed identity</span>
az<span class="w"> </span>keyvault<span class="w"> </span>set-policy<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span>openspp-vault<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--object-id<span class="w"> </span>&lt;managed-identity-id&gt;<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--key-permissions<span class="w"> </span>get<span class="w"> </span>unwrapKey<span class="w"> </span>wrapKey
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h3>OpenSPP Configuration<a class="headerlink" href="#id4" title="Permalink to this headline">#</a></h3>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[encryption]</span>
<span class="na">key_provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">azure_kv</span>
<span class="na">azure_vault_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">https://openspp-vault.vault.azure.net/</span>
<span class="na">azure_key_name_pii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">pii-encryption</span>

<span class="c1"># If not using managed identity:</span>
<span class="na">azure_tenant_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&lt;tenant-id&gt;</span>
<span class="na">azure_client_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&lt;client-id&gt;</span>
<span class="na">azure_client_secret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&lt;client-secret&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="key-rotation">
<h2>Key Rotation<a class="headerlink" href="#key-rotation" title="Permalink to this headline">#</a></h2>
<p>Rotate keys annually or after suspected compromise.</p>
<div class="section" id="rotation-process">
<h3>Rotation Process<a class="headerlink" href="#rotation-process" title="Permalink to this headline">#</a></h3>
<ol class="arabic simple">
<li><p><strong>Create new key version</strong></p></li>
<li><p><strong>Encrypt new data with new key</strong></p></li>
<li><p><strong>Re-encrypt existing data</strong> (background job)</p></li>
<li><p><strong>Archive old key version</strong></p></li>
</ol>
</div>
<div class="section" id="database-provider-rotation">
<h3>Database Provider Rotation<a class="headerlink" href="#database-provider-rotation" title="Permalink to this headline">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>odoo-bin<span class="w"> </span>shell<span class="w"> </span>-d<span class="w"> </span>openspp_prod

<span class="c1"># Create new key version</span>
<span class="nv">new_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>env<span class="o">[</span><span class="s1">'spp.encryption.key'</span><span class="o">]</span>.rotate_key<span class="o">(</span><span class="s1">'pii'</span><span class="o">)</span>
print<span class="o">(</span>f<span class="s2">"Created key version {new_version}"</span><span class="o">)</span>

<span class="c1"># Mark old version as archived</span>
<span class="nv">old_keys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>env<span class="o">[</span><span class="s1">'spp.encryption.key'</span><span class="o">]</span>.search<span class="o">([</span>
<span class="w">    </span><span class="o">(</span><span class="s1">'key_id'</span>,<span class="w"> </span><span class="s1">'='</span>,<span class="w"> </span><span class="s1">'pii'</span><span class="o">)</span>,
<span class="w">    </span><span class="o">(</span><span class="s1">'is_current'</span>,<span class="w"> </span><span class="s1">'='</span>,<span class="w"> </span>False<span class="o">)</span>,
<span class="o">])</span>
print<span class="o">(</span>f<span class="s2">"Archived {len(old_keys)} old versions"</span><span class="o">)</span>

<span class="c1"># Re-encrypt data (background job)</span>
<span class="nv">wizard</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>env<span class="o">[</span><span class="s1">'spp.key.rotation.wizard'</span><span class="o">]</span>.create<span class="o">({</span>
<span class="w">    </span><span class="s1">'key_id'</span>:<span class="w"> </span><span class="s1">'pii'</span>,
<span class="w">    </span><span class="s1">'old_version'</span>:<span class="w"> </span><span class="m">1</span>,
<span class="w">    </span><span class="s1">'new_version'</span>:<span class="w"> </span>new_version,
<span class="o">})</span>
wizard.action_rotate<span class="o">()</span>
</pre></div>
</div>
</div>
<div class="section" id="vault-provider-rotation">
<h3>Vault Provider Rotation<a class="headerlink" href="#vault-provider-rotation" title="Permalink to this headline">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Rotate in Vault</span>
vault<span class="w"> </span>write<span class="w"> </span>-f<span class="w"> </span>transit/keys/openspp-pii/rotate

<span class="c1"># Update OpenSPP to use new version (automatic)</span>
<span class="c1"># Old ciphertext can still be decrypted with old version</span>
</pre></div>
</div>
</div>
<div class="section" id="aws-kms-rotation">
<h3>AWS KMS Rotation<a class="headerlink" href="#aws-kms-rotation" title="Permalink to this headline">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Enable automatic rotation</span>
aws<span class="w"> </span>kms<span class="w"> </span>enable-key-rotation<span class="w"> </span>--key-id<span class="w"> </span>&lt;key-id&gt;

<span class="c1"># Check rotation status</span>
aws<span class="w"> </span>kms<span class="w"> </span>get-key-rotation-status<span class="w"> </span>--key-id<span class="w"> </span>&lt;key-id&gt;
</pre></div>
</div>
</div>
</div>
<div class="section" id="key-backup-and-recovery">
<h2>Key Backup and Recovery<a class="headerlink" href="#key-backup-and-recovery" title="Permalink to this headline">#</a></h2>
<div class="section" id="config-provider-backup">
<h3>Config Provider Backup<a class="headerlink" href="#config-provider-backup" title="Permalink to this headline">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Backup config file</span>
sudo<span class="w"> </span>cp<span class="w"> </span>/etc/odoo/odoo.conf<span class="w"> </span>/secure/backup/odoo.conf.<span class="k">$(</span>date<span class="w"> </span>+%Y%m%d<span class="k">)</span>

<span class="c1"># Encrypt backup</span>
gpg<span class="w"> </span>--symmetric<span class="w"> </span>--cipher-algo<span class="w"> </span>AES256<span class="w"> </span>/secure/backup/odoo.conf.*

<span class="c1"># Store off-site</span>
rsync<span class="w"> </span>-av<span class="w"> </span>/secure/backup/*.gpg<span class="w"> </span>backup-server:/openspp-backups/
</pre></div>
</div>
</div>
<div class="section" id="database-provider-backup">
<h3>Database Provider Backup<a class="headerlink" href="#database-provider-backup" title="Permalink to this headline">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Export keys (encrypted with master key)</span>
odoo-bin<span class="w"> </span>shell<span class="w"> </span>-d<span class="w"> </span>openspp_prod

<span class="nv">keys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>env<span class="o">[</span><span class="s1">'spp.encryption.key'</span><span class="o">]</span>.search<span class="o">([])</span>
import<span class="w"> </span>json
<span class="nv">key_export</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[]</span>
<span class="k">for</span><span class="w"> </span>key<span class="w"> </span><span class="k">in</span><span class="w"> </span>keys:
<span class="w">    </span>key_export.append<span class="o">({</span>
<span class="w">        </span><span class="s1">'key_id'</span>:<span class="w"> </span>key.key_id,
<span class="w">        </span><span class="s1">'version'</span>:<span class="w"> </span>key.version,
<span class="w">        </span><span class="s1">'encrypted_key'</span>:<span class="w"> </span>key.encrypted_key.decode<span class="o">(</span><span class="s1">'latin-1'</span><span class="o">)</span>,
<span class="w">        </span><span class="s1">'algorithm'</span>:<span class="w"> </span>key.algorithm,
<span class="w">        </span><span class="s1">'purpose'</span>:<span class="w"> </span>key.purpose,
<span class="w">    </span><span class="o">})</span>

with<span class="w"> </span>open<span class="o">(</span><span class="s1">'/tmp/keys_backup.json'</span>,<span class="w"> </span><span class="s1">'w'</span><span class="o">)</span><span class="w"> </span>as<span class="w"> </span>f:
<span class="w">    </span>json.dump<span class="o">(</span>key_export,<span class="w"> </span>f,<span class="w"> </span><span class="nv">indent</span><span class="o">=</span><span class="m">2</span><span class="o">)</span>

<span class="c1"># Encrypt export</span>
gpg<span class="w"> </span>--symmetric<span class="w"> </span>--cipher-algo<span class="w"> </span>AES256<span class="w"> </span>/tmp/keys_backup.json
rm<span class="w"> </span>/tmp/keys_backup.json

<span class="c1"># Store master key separately (from odoo.conf)</span>
</pre></div>
</div>
</div>
<div class="section" id="vault-provider-backup">
<h3>Vault Provider Backup<a class="headerlink" href="#vault-provider-backup" title="Permalink to this headline">#</a></h3>
<p>Vault handles backups. Ensure Vault itself is backed up:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Backup Vault data</span>
vault<span class="w"> </span>operator<span class="w"> </span>raft<span class="w"> </span>snapshot<span class="w"> </span>save<span class="w"> </span>backup.snap

<span class="c1"># Store snapshot securely</span>
gpg<span class="w"> </span>--symmetric<span class="w"> </span>--cipher-algo<span class="w"> </span>AES256<span class="w"> </span>backup.snap
</pre></div>
</div>
</div>
<div class="section" id="cloud-kms-backup">
<h3>Cloud KMS Backup<a class="headerlink" href="#cloud-kms-backup" title="Permalink to this headline">#</a></h3>
<p>AWS/GCP/Azure KMS keys are automatically backed up by the cloud provider. Document key ARNs/IDs:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># AWS</span>
aws<span class="w"> </span>kms<span class="w"> </span>describe-key<span class="w"> </span>--key-id<span class="w"> </span>&lt;key-id&gt;<span class="w"> </span>&gt;<span class="w"> </span>/secure/backup/aws_kms_info.json

<span class="c1"># GCP</span>
gcloud<span class="w"> </span>kms<span class="w"> </span>keys<span class="w"> </span>describe<span class="w"> </span>pii-encryption<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--keyring<span class="w"> </span>openspp<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--location<span class="w"> </span>global<span class="w"> </span>&gt;<span class="w"> </span>/secure/backup/gcp_kms_info.txt
</pre></div>
</div>
</div>
</div>
<div class="section" id="key-recovery">
<h2>Key Recovery<a class="headerlink" href="#key-recovery" title="Permalink to this headline">#</a></h2>
<div class="section" id="lost-master-key-config-database-provider">
<h3>Lost Master Key (Config/Database Provider)<a class="headerlink" href="#lost-master-key-config-database-provider" title="Permalink to this headline">#</a></h3>
<p>If master key is lost, <strong>encrypted data is unrecoverable</strong>.</p>
<p>Recovery options:</p>
<ol class="arabic simple">
<li><p>Restore from key backup</p></li>
<li><p>Restore database from backup before key loss</p></li>
</ol>
</div>
<div class="section" id="lost-cloud-kms-access">
<h3>Lost Cloud KMS Access<a class="headerlink" href="#lost-cloud-kms-access" title="Permalink to this headline">#</a></h3>
<p>If you lose access to cloud KMS:</p>
<ol class="arabic simple">
<li><p>Restore IAM permissions</p></li>
<li><p>Restore KMS key from cloud provider backup</p></li>
<li><p>Contact cloud provider support</p></li>
</ol>
</div>
<div class="section" id="testing-key-recovery">
<h3>Testing Key Recovery<a class="headerlink" href="#testing-key-recovery" title="Permalink to this headline">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. Backup current keys</span>
<span class="c1"># 2. Remove keys from system</span>
<span class="c1"># 3. Restore from backup</span>
<span class="c1"># 4. Verify decryption works</span>

odoo-bin<span class="w"> </span>shell<span class="w"> </span>-d<span class="w"> </span>openspp_prod

<span class="c1"># Test decryption</span>
<span class="nv">reg_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>env<span class="o">[</span><span class="s1">'spp.registry.id'</span><span class="o">]</span>.search<span class="o">([]</span>,<span class="w"> </span><span class="nv">limit</span><span class="o">=</span><span class="m">1</span><span class="o">)</span>
try:
<span class="w">    </span><span class="nv">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>reg_id.value<span class="w">  </span><span class="c1"># Should decrypt successfully</span>
<span class="w">    </span>print<span class="o">(</span><span class="s2">"Key recovery successful"</span><span class="o">)</span>
except<span class="w"> </span>Exception<span class="w"> </span>as<span class="w"> </span>e:
<span class="w">    </span>print<span class="o">(</span>f<span class="s2">"Key recovery failed: {e}"</span><span class="o">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="key-escrow">
<h2>Key Escrow<a class="headerlink" href="#key-escrow" title="Permalink to this headline">#</a></h2>
<p>For regulated environments, set up key escrow:</p>
<div class="section" id="manual-escrow">
<h3>Manual Escrow<a class="headerlink" href="#manual-escrow" title="Permalink to this headline">#</a></h3>
<ol class="arabic simple">
<li><p>Export keys to encrypted file</p></li>
<li><p>Split into key shares (Shamir's Secret Sharing)</p></li>
<li><p>Distribute shares to trusted parties</p></li>
<li><p>Document recovery procedure</p></li>
</ol>
</div>
<div class="section" id="vault-auto-unseal">
<h3>Vault Auto-Unseal<a class="headerlink" href="#vault-auto-unseal" title="Permalink to this headline">#</a></h3>
<p>Use cloud KMS to auto-unseal Vault:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Configure Vault with AWS KMS auto-unseal</span>
vault<span class="w"> </span>operator<span class="w"> </span>init<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-recovery-shares<span class="o">=</span><span class="m">5</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-recovery-threshold<span class="o">=</span><span class="m">3</span>

<span class="c1"># Recovery keys stored in AWS KMS</span>
<span class="c1"># Vault unseals automatically on restart</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="security-checklist">
<h2>Security Checklist<a class="headerlink" href="#security-checklist" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>[ ] Keys generated with cryptographically secure RNG</p></li>
<li><p>[ ] Master key stored separately from database backups</p></li>
<li><p>[ ] Key backups encrypted and stored off-site</p></li>
<li><p>[ ] Key rotation schedule documented</p></li>
<li><p>[ ] Key recovery procedure tested</p></li>
<li><p>[ ] Access to keys restricted (file permissions, IAM)</p></li>
<li><p>[ ] Key access audited</p></li>
<li><p>[ ] Index salts never rotated (breaks search)</p></li>
<li><p>[ ] Old key versions retained for decryption</p></li>
<li><p>[ ] Key escrow configured (if required)</p></li>
</ul>
</div>
<div class="section" id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">#</a></h2>
<p><strong>Key not found error</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check key exists</span>
odoo-bin<span class="w"> </span>shell<span class="w"> </span>-d<span class="w"> </span>openspp_prod
env<span class="o">[</span><span class="s1">'spp.encryption.key'</span><span class="o">]</span>.search<span class="o">([(</span><span class="s1">'key_id'</span>,<span class="w"> </span><span class="s1">'='</span>,<span class="w"> </span><span class="s1">'pii'</span><span class="o">)])</span>

<span class="c1"># Check config has key</span>
grep<span class="w"> </span><span class="s2">"encryption_key_pii"</span><span class="w"> </span>/etc/odoo/odoo.conf
</pre></div>
</div>
<p><strong>Vault connection failed</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Test Vault access</span>
vault<span class="w"> </span>login<span class="w"> </span>-method<span class="o">=</span>approle<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="nv">role_id</span><span class="o">=</span><span class="nv">$VAULT_ROLE_ID</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="nv">secret_id</span><span class="o">=</span><span class="nv">$VAULT_SECRET_ID</span>

<span class="c1"># Test key access</span>
vault<span class="w"> </span>write<span class="w"> </span>transit/datakey/plaintext/openspp-pii<span class="w"> </span><span class="nv">bits</span><span class="o">=</span><span class="m">256</span>
</pre></div>
</div>
<p><strong>AWS KMS access denied</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check IAM permissions</span>
aws<span class="w"> </span>kms<span class="w"> </span>describe-key<span class="w"> </span>--key-id<span class="w"> </span>&lt;key-id&gt;

<span class="c1"># Check instance role</span>
curl<span class="w"> </span>http://169.254.169.254/latest/meta-data/iam/security-credentials/
</pre></div>
</div>
<p><strong>Re-encryption job stuck</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check job status</span>
odoo-bin<span class="w"> </span>shell<span class="w"> </span>-d<span class="w"> </span>openspp_prod
<span class="nb">jobs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>env<span class="o">[</span><span class="s1">'queue.job'</span><span class="o">]</span>.search<span class="o">([(</span><span class="s1">'name'</span>,<span class="w"> </span><span class="s1">'like'</span>,<span class="w"> </span><span class="s1">'rotate_key'</span><span class="o">)])</span>
<span class="k">for</span><span class="w"> </span>job<span class="w"> </span><span class="k">in</span><span class="w"> </span>jobs:
<span class="w">    </span>print<span class="o">(</span>f<span class="s2">"{job.state}: {job.exc_info}"</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="section" id="related-documentation">
<h2>Related Documentation<a class="headerlink" href="#related-documentation" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>PII encryption: <a class="reference internal" href="pii_encryption.html"><span class="doc">PII Encryption</span></a></p></li>
<li><p>Data classification: <a class="reference internal" href="data_classification.html"><span class="doc">Data Classification</span></a></p></li>
<li><p>Audit logging: <a class="reference internal" href="audit.html"><span class="doc">Audit Logging</span></a></p></li>
</ul>
</div>
</div>
</div>
</main>
<footer class="footer-article noprint">
<!-- Previous / next buttons -->
<div class="prev-next-area">
<a class="left-prev" href="pii_encryption.html" id="prev-link" title="previous page">
<i class="fas fa-angle-left"></i>
<div class="prev-next-info">
<p class="prev-next-subtitle">previous</p>
<p class="prev-next-title">PII Encryption</p>
</div>
</a>
<a class="right-next" href="audit.html" id="next-link" title="next page">
<div class="prev-next-info">
<p class="prev-next-subtitle">next</p>
<p class="prev-next-title">Audit Logging</p>
</div>
<i class="fas fa-angle-right"></i>
</a>
</div>
</footer>
</div>
</div>
<div class="footer-content row">
<footer class="col footer"><p>
  
    By The OpenSPP community<br/>
  
      © Copyright OpenSPP.<br/>
<div class="extra_footer">
<p>The text and illustrations in this website are licensed by the OpenSPP Project under a Creative Commons Attribution 4.0 International license. All other trademarks are owned by their respective owners.</p>
</div>
</p>
</footer>
</div>
</div>
</div>
</div>
<!-- Scripts loaded after <body> so the DOM is not blocked -->
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
<script type="text/javascript">
        $(document).ready(function() {
            // Hide empty sub menu.
            var lists = $("div.toctree-wrapper ul");
            $.each(lists, function(index, list) {
                if($(list).find("li").length == 0) {
                    $(list).prev().hide();
                    $(list).hide();
                }
            });
        })
    </script>
<script src="/_static/version_switcher.js"></script></body>
</html>